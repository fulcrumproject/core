# Consumer API Tests

@baseUrl = http://localhost:3000/api/v1
@adminToken = admin-test-token

### List all consumers
GET {{baseUrl}}/consumers
Authorization: Bearer {{adminToken}}

### Create a new consumer
# @name createConsumer
POST {{baseUrl}}/consumers
Authorization: Bearer {{adminToken}}

{
  "name": "Test Consumer"
}

@consumerId = {{createConsumer.response.body.$.id}}

### Create a new consumer 2
# @name createConsumer2
POST {{baseUrl}}/consumers
Authorization: Bearer {{adminToken}}

{
  "name": "Test Consumer 2"
}

@consumerId2 = {{createConsumer2.response.body.$.id}}

### Get consumer by ID
GET {{baseUrl}}/consumers/{{consumerId}}
Authorization: Bearer {{adminToken}}

### Update consumer
PATCH {{baseUrl}}/consumers/{{consumerId}}
Authorization: Bearer {{adminToken}}

{
  "name": "Updated Consumer Name"
}

### Create a new consumer token
#Â @name createConsumerToken
POST {{baseUrl}}/tokens
Authorization: Bearer {{adminToken}}

{
  "name": "Test Consumer Token",
  "role": "consumer",
  "expireAt": "{{$datetime iso8601 1 y}}",
  "scopeId": "{{consumerId}}"
}

@consumerToken = {{createConsumerToken.response.body.$.value}}

### Get consumer by ID
GET {{baseUrl}}/consumers/{{consumerId}}
Authorization: Bearer {{consumerToken}}

### Get consumers
GET {{baseUrl}}/consumers
Authorization: Bearer {{consumerToken}}

### Get consumers SHOULD FAIL 403
GET {{baseUrl}}/consumers/{{consumerId2}}
Authorization: Bearer {{consumerToken}}

### Delete consumer
DELETE {{baseUrl}}/consumers/{{consumerId}}
Authorization: Bearer {{adminToken}}